# 참고 문서: 인프라 의사결정 상세

> 이 문서는 1단계 수작업 배포에서 선택한 인프라 구성의 상세 비교 분석을 담고 있습니다.
> 본문([README.md](../../../../README.md))에서는 결론만 요약하고, 상세 근거는 이 문서를 참고하세요.

---

## A. 온프레미스 환경 제외 이유

| 관점           | 제외 사유                                                                |
| -------------- | ------------------------------------------------------------------------ |
| 선투자 비용    | 서비스 가치 검증 전 회수 불가능한 비용 발생                              |
| 실험 실패 비용 | 잘못 선택한 장비/구성이 자산으로 남아 폐기+유지 비용 동시 발생           |
| 조달 속도      | 서버 증설/교체에 수일~수주 소요, 서비스 개발 속도의 병목                 |
| 운영 부담      | 하드웨어 장애, 네트워크 장애, 물리 보안 등 소규모 팀에 과도한 책임       |
| 확장성         | 초기부터 최대 부하를 가정한 설계 필요, 확장 시 구조 변경 비용이 큼       |

**결론:** MVP 단계에서는 클라우드(AWS)를 사용하여 초기 투자 없이 빠르게 시작하고, 필요에 따라 스케일 조정이 가능한 환경을 선택함.

---

## B. Web/API 인프라: AWS 직접 관리 vs PaaS

### B.1 비교표

| 관점          | AWS 직접 관리                 | PaaS (Vercel 등)       |
| ------------- | ----------------------------- | ---------------------- |
| 월 비용       | ~$110                         | ~$20 (Pro) + 초과 과금 |
| 커스텀        | WebSocket, 복잡한 백엔드 가능 | 제한적                 |
| 인프라 제어   | 완전 제어                     | 제한적                 |
| 관리 오버헤드 | 있음 (직접 운영)              | 없음 (위탁)            |

### B.2 AWS 직접 관리 선택 이유

1. **팀 역량**: 인프라 엔지니어가 있어 직접 관리 시 비용 최적화 가능
2. **기능 요구사항**: WebSocket, 백그라운드 작업 등 PaaS 한계 예상
3. **레퍼런스**: AWS 레퍼런스가 압도적으로 많아 문제 해결 속도 빠름

### B.3 핵심 원칙

> "직접 관리 가능하면 직접 관리, 비용 차이가 압도적이면 외부 서비스 활용"

---

## C. GPU 인프라: AWS GPU vs RunPod vs 외부 API

### C.1 비교표

| 관점              | AWS GPU (g4dn.xlarge)  | RunPod Flex                 | 외부 API (OpenAI 등) |
| ----------------- | ---------------------- | --------------------------- | -------------------- |
| 월 비용 (DAU 30)  | ~$380 (24/7 상시 가동) | **~$0.9**                   | ~$15                 |
| 사용 패턴         | 상시 가동만 가능       | Serverless (사용 시만 과금) | Serverless           |
| 커스텀 모델       | 가능                   | 가능                        | 불가                 |
| 데이터 프라이버시 | 자체 인프라            | 자체 인프라                 | 외부 전송            |

### C.2 AWS GPU가 비싼 핵심 이유

AWS는 GPU Serverless 옵션이 없음. EC2 GPU 인스턴스는 24/7 상시 가동만 가능하여 저트래픽 환경에서 비효율적.

### C.3 RunPod Serverless 선택 이유

1. **Serverless 지원** - AWS GPU는 상시 가동만 가능, RunPod은 사용량 기반 과금
2. **데이터 보안** - 영수증 등 민감 데이터 외부 API 미전송
3. **저트래픽 환경** - DAU 30명, 하루 50건 요청으로 상시 가동 불필요

### C.4 RunPod 가격 상세 (24GB GPU 기준)

| 타입          | 초당 가격 | 시간당 환산 | 특징                        |
| ------------- | --------- | ----------- | --------------------------- |
| Flex Worker   | $0.00019  | ~$0.68      | 사용 시만 과금, 0으로 축소  |
| Active Worker | $0.00013  | ~$0.47      | 24/7 상시 가동, 20~30% 할인 |

### C.5 DAU 30 기준 예상 비용 (Flex)

| 항목             | 값                  |
| ---------------- | ------------------- |
| 일일 요청        | ~50건               |
| 요청당 처리 시간 | ~3초                |
| 월간 GPU 시간    | ~1.25시간 (4,500초) |
| **월간 비용**    | **~$0.9**           |

### C.6 스케일업 기준

> DAU 500명 이상이거나 응답 속도가 중요한 경우 Active 모드 또는 외부 API 검토

---

## D. EC2 아키텍처 대안 비교

### D.1 Option 정의

| Option | 구성                                                     |
| ------ | -------------------------------------------------------- |
| A      | 단일 EC2 (현재 선택)                                     |
| B      | 서비스 분리 (Public Subnet) - EC2 2대 + RDS (pgvector)   |
| C      | 서비스 분리 + Private Subnet - EC2 2대 + RDS + ALB + NAT |

> **참고:** 벡터 검색은 PostgreSQL의 pgvector 확장을 사용하여 RDS에 통합. 별도 벡터 DB 불필요.

### D.2 비용 비교표

| 구성 요소      | Option A (단일) | Option B (분리)   | Option C (분리+Private) |
| -------------- | --------------- | ----------------- | ----------------------- |
| EC2 Frontend   | -               | t4g.small ~$12    | t4g.small ~$12          |
| EC2 Backend    | -               | t4g.small ~$12    | t4g.small ~$12          |
| RDS PostgreSQL | -               | db.t4g.micro ~$15 | db.t4g.micro ~$15       |
| EC2 (통합)     | t4g.xlarge ~$98 | -                 | -                       |
| EBS            | gp3 100GB ~$11  | gp3 20GB x2 ~$5   | gp3 20GB x2 ~$5         |
| ALB            | -               | -                 | ~$18                    |
| NAT Gateway    | -               | -                 | ~$35                    |
| 데이터 전송    | ~$1             | ~$3               | ~$5                     |
| **월 총계**    | **~$110**       | **~$47**          | **~$102**               |

### D.3 종합 비교

| 항목          | Option A | Option B   | Option C      |
| ------------- | -------- | ---------- | ------------- |
| 월 비용       | ~$110    | ~$47       | ~$102         |
| 관리 복잡도   | 낮음     | 중간       | 높음          |
| 보안 수준     | 보안그룹 | 보안그룹   | 네트워크 격리 |
| 장애 격리     | 없음     | 있음       | 있음          |
| 개별 스케일링 | 불가     | 가능       | 가능          |
| 배포 복잡도   | 단순     | CI/CD 필요 | CI/CD 필요    |

### D.4 Option A 선택 이유

- DAU 30명 수준에서 장애 격리/개별 스케일링 필요성 낮음
- 관리 포인트 최소화 (EC2 1대만 관리)
- Option B가 더 저렴하나, 서비스 3개 관리 오버헤드 발생
- 트래픽 증가 시 Option B/C로 전환 고려

---

## E. 인스턴스 선정 및 예상 비용

### E.1 예상 트래픽 규모

| 항목        | 예상치       |
| ----------- | ------------ |
| DAU         | ~30명        |
| 동시접속    | 3~5명        |
| 일일 요청량 | ~500 req/day |

### E.2 인스턴스 선정: t4g.xlarge

| 인스턴스 타입  | vCPU | RAM  | 서울 리전 시간당 가격 | 월간 비용 (730h) |
| -------------- | ---- | ---- | --------------------- | ---------------- |
| **t4g.xlarge** | 4    | 16GB | $0.1341               | **~$98**         |

**구성 요소별 예상 리소스 사용량:**

| 구성 요소   | 예상 RAM  | 예상 CPU | 비고                    |
| ----------- | --------- | -------- | ----------------------- |
| Nginx       | 100~200MB | < 1%     | 리버스 프록시, TLS 처리 |
| Next.js     | 500MB~1GB | 5~10%    |                         |
| Spring Boot | 1.5~2GB   | 10~20%   | 힙 1~1.5GB              |
| PostgreSQL  | 2~4GB     | 5~20%    | pgvector 확장 포함      |
| OS          | 1~1.5GB   | 5%       | 시스템 프로세스, 로깅   |
| **합계**    | **~7GB**  | **~45%** | 여유 9GB 확보           |

### E.3 선정 근거

1. **RAM 16GB 충분**
   - 예상 사용량 ~7GB, 여유분 ~9GB 확보
   - 스왑 미설정 (OOM 발생 시 프로세스 종료로 빠른 문제 인지)

2. **CPU 버스트 크레딧 유지 가능**
   - DAU 30명 기준 평균 CPU 사용률 ~50% 이하
   - t4g.xlarge 기준선: 40% (이하면 크레딧 축적)
   - 피크 시에만 버스트, 평상시 크레딧 회복

3. **Graviton2(ARM) 가성비**
   - 동일 스펙 x86 대비 약 20% 저렴
   - Node.js, Java, PostgreSQL 모두 ARM 호환

### E.4 스토리지 선정: gp3 100GB

| 항목     | 사양         | 월 비용 |
| -------- | ------------ | ------- |
| 스토리지 | 100GB        | ~$11.4  |
| IOPS     | 3,000 (기본) | $0      |

### E.5 총 예상 비용 (월간)

| 항목         | 사양            | 월 비용      |
| ------------ | --------------- | ------------ |
| EC2 인스턴스 | t4g.xlarge      | ~$98         |
| EBS 스토리지 | gp3 100GB       | ~$11         |
| 데이터 전송  | 10GB 아웃바운드 | ~$1          |
| **총계**     |                 | **~$110/월** |

### E.6 GPU 서버 (RunPod Serverless)

| 항목          | 값                       |
| ------------- | ------------------------ |
| 모델          | Qwen/Qwen2.5-7B-Instruct |
| 추론 엔진     | vLLM                     |
| GPU           | L4 24GB (Flex Worker)    |
| **월간 비용** | **~$0.9** (DAU 30 기준)  |

### E.7 인프라 선택 요약

| 워크로드          | 선택              | 선택 이유                       |
| ----------------- | ----------------- | ------------------------------- |
| **Web/API**       | AWS EC2 직접 관리 | 팀 역량 활용, 비용 최적화       |
| **GPU (AI 추론)** | RunPod Serverless | 저트래픽에서 압도적 비용 효율성 |

---

## 참고 링크

- [AWS EC2 요금](https://aws.amazon.com/ec2/pricing/)
- [RunPod Serverless 요금](https://docs.runpod.io/serverless/pricing)
- [AWS RDS 요금](https://aws.amazon.com/rds/pricing/)
