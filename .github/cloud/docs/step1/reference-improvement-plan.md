# 참고 문서: 문제 시나리오 및 개선 계획

> 이 문서는 1단계 수작업 배포의 구체적인 문제 시나리오와 향후 개선 계획을 담고 있습니다.
> 본문([README.md](../../../../README.md))에서는 한계 분석 요약만 다루고, 상세 내용은 이 문서를 참고하세요.

---

## A. 구체적 문제 시나리오

### A.1 인적 오류 (Human Error)

수작업 배포에서 발생할 수 있는 인적 오류 유형입니다.

| 오류 유형           | 발생 상황                          | 영향                         |
| ------------------- | ---------------------------------- | ---------------------------- |
| 명령어 오타         | 잘못된 서버 접속, 잘못된 경로 접근 | 배포 실패, 데이터 손실 위험  |
| 배포 순서 착오      | DB 마이그레이션 누락 후 코드 배포  | 애플리케이션 오류, 롤백 필요 |
| 환경 변수 설정 누락 | 새로운 환경변수 미반영             | 서비스 장애, 기능 동작 불가  |
| 파일 전송 누락      | 일부 파일만 전송                   | 부분 배포, 불일치 상태       |
| 백업 누락           | 배포 전 백업 미수행                | 롤백 불가, 데이터 복구 불가  |

**실제 발생 가능 시나리오:**

1. **시나리오 1: 경로 오타**

   ```bash
   # 의도: /app/backend/app.jar
   # 실수: /app/backen/app.jar (d 누락)
   scp app.jar user@server:/app/backen/app.jar  # 새 폴더 생성됨
   ```

   → 기존 jar가 교체되지 않아 이전 버전이 실행됨

2. **시나리오 2: 순서 착오**

   ```bash
   # 올바른 순서: DB 마이그레이션 → Backend 재시작
   # 실수: Backend 재시작 → DB 마이그레이션 (순서 뒤바뀜)
   ```

   → 새 코드가 이전 스키마를 참조하여 에러 발생

3. **시나리오 3: 환경변수 누락**
   ```bash
   # 새 기능에 필요한 API_KEY 환경변수 미설정
   # 애플리케이션 시작 시 NullPointerException 발생
   ```
   → 서비스 시작 실패 또는 특정 기능 동작 불가

### A.2 서비스 중단 (Downtime)

| 항목                | 값                                |
| ------------------- | --------------------------------- |
| 배포 중 서비스 중단 | 약 8분                            |
| 분당 예상 요청 수   | ~10 requests/min (피크 시간 기준) |
| 예상 실패 요청      | 약 80건                           |
| 사용자 영향         | 전체 사용자 접속 불가             |

**다운타임 발생 구간:**

```
서비스 중단 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 서비스 재개
     ↑                                        ↑
   5단계                                    11단계
(Backend 중단)                         (Frontend 시작)
```

### A.3 확장성 문제

현재 단일 서버 구조에서 트래픽 증가 시 발생하는 문제입니다.

| 문제                   | 현재 상태 | 트래픽 증가 시              |
| ---------------------- | --------- | --------------------------- |
| 서버 증설              | 1대       | 수작업 배포를 N대 반복      |
| 배포 복잡도            | 선형적    | N대 × 배포시간 = 기하급수적 |
| 마이크로서비스 전환 시 | 해당 없음 | 서비스별 배포 관리 불가     |
| 동시 배포              | 불가      | 순차 배포만 가능            |

### A.4 추적성 부족

| 문제                | 현재 상태             | 영향                               |
| ------------------- | --------------------- | ---------------------------------- |
| 배포 이력 관리      | 수동 기록 또는 미기록 | 어떤 버전이 언제 배포됐는지 불명확 |
| 변경 추적           | Git 커밋 로그만 존재  | 실제 서버 반영 시점 불명확         |
| 문제 원인 추적      | 로그 분석에 의존      | 원인 파악에 시간 소요              |
| 배포 성공/실패 기록 | 없음                  | 패턴 분석, 개선 불가               |

### A.5 협업의 어려움

| 문제             | 현재 상태           | 영향                         |
| ---------------- | ------------------- | ---------------------------- |
| 배포 가능 인원   | 1~2명 (담당자)      | 담당자 부재 시 배포 불가     |
| 신규 팀원 온보딩 | 구두 전달 또는 문서 | 학습 부담, 실수 가능성       |
| 긴급 배포        | 담당자 연락 필수    | 대응 지연                    |
| 지식 공유        | 담당자 의존         | 단일 장애점 (Bus Factor = 1) |

---

## B. 개선 필요성 및 향후 계획

### B.1 종합 평가

> 본 구조는 초기 실험 속도와 비용 최소화를 위해 의도적으로 단순화한 형태이나,
> 퍼블릭 네트워크 노출, 단일 장애 지점, 리소스 경쟁, 수평 확장 불가,
> 수작업 배포에 따른 인적 오류 등 다면적 제약을 가진다.

### B.2 임계점 (Threshold)

다음 조건 중 하나라도 충족 시 자동화 도입을 검토해야 합니다:

- [ ] 주 2회 이상 배포 빈도
- [ ] 월간 활성 사용자 1,000명 이상 도달
- [ ] 서버 대수 2대 이상 증가
- [ ] 배포 실패 또는 롤백 발생 횟수 월 2회 이상
- [ ] 다운타임으로 인한 사용자 불만 접수

### B.3 다음 단계 전략

| 단계 | 전략                                    | 예상 효과                      |
| ---- | --------------------------------------- | ------------------------------ |
| 단기 | 배포 스크립트 작성으로 반복 작업 자동화 | 인적 오류 감소, 배포 시간 단축 |
| 중기 | CI/CD 파이프라인 구축                   | 자동 테스트, 품질 게이트 확보  |
| 장기 | Blue-Green 또는 Rolling 배포 전략 도입  | 무중단 배포, 안전한 롤백       |

### B.4 필수 개선 항목 (일정 규모 도달 시)

| 항목          | 현재 상태           | 개선 방향                 |
| ------------- | ------------------- | ------------------------- |
| DB 분리       | EC2 내 PostgreSQL   | RDS 또는 별도 인스턴스    |
| 네트워크 격리 | 퍼블릭 서브넷       | 프라이빗 서브넷 전환      |
| 배포 자동화   | 수작업 배포         | CI/CD 파이프라인          |
| 관측 체계     | 로그 파일 직접 확인 | CloudWatch, Prometheus 등 |
| 보안 체계     | 보안그룹만 적용     | WAF, VPC 엔드포인트 등    |
| 시크릿 관리   | .env 파일           | AWS Secrets Manager       |

---

## C. 단계별 개선 로드맵

### C.1 단기 (1~2주)

**목표:** 수작업 배포의 안정성 향상

- [ ] 배포 스크립트 작성 (backup.sh, deploy.sh, rollback.sh)
- [ ] 배포 체크리스트 문서화
- [ ] 배포 로그 기록 시작 (날짜, 버전, 담당자, 결과)

### C.2 중기 (1~2개월)

**목표:** CI/CD 파이프라인 구축

- [ ] GitHub Actions 워크플로우 설정
- [ ] 자동 빌드 및 테스트 파이프라인
- [ ] 스테이징 환경 자동 배포
- [ ] 프로덕션 승인형 배포

### C.3 장기 (2~3개월)

**목표:** 무중단 배포 및 인프라 분리

- [ ] DB 분리 (RDS 마이그레이션)
- [ ] Blue-Green 또는 Rolling 배포 전략 도입
- [ ] 프라이빗 서브넷 전환
- [ ] 모니터링/알림 시스템 구축

---

## D. 개선 효과 예상

### D.1 정량적 개선 예상

| 지표             | 현재 상태    | 개선 후 예상       |
| ---------------- | ------------ | ------------------ |
| 배포 소요 시간   | 약 38분      | 10분 이내          |
| 서비스 중단 시간 | 약 8분       | 0분 (무중단 배포)  |
| 인적 오류 가능성 | 높음         | 낮음 (자동화)      |
| 담당자 의존도    | 높음 (1~2명) | 낮음 (누구나 배포) |
| 롤백 소요 시간   | 약 11분      | 1분 이내           |
| 배포 가능 빈도   | 주 1회       | 일 수회            |

### D.2 정성적 개선 예상

- **개발자 경험 향상:** 배포 부담 감소로 개발에 집중
- **서비스 안정성 향상:** 자동 테스트로 품질 게이트 확보
- **빠른 피드백 루프:** 코드 변경 → 배포 → 검증 주기 단축
- **지식 공유:** 배포 절차가 코드로 문서화되어 팀 전체 공유

---

## 참고 링크

- [GitHub Actions 공식 문서](https://docs.github.com/en/actions)
- [AWS Blue-Green 배포 가이드](https://docs.aws.amazon.com/whitepapers/latest/blue-green-deployments/welcome.html)
- [The Twelve-Factor App - Disposability](https://12factor.net/disposability)
