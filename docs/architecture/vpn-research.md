# DB 접근 보호방식

## DB 접근 보호방식을 우선 고려한 이유

> 서버가 뚫리면 서비스 장애가 발생하지만, DB가 뚫리면 **데이터 유출 및 위변조**라는 돌이킬 수 없는 사고로 이어집니다. 가장 위험도가 높은 곳에 보안 자원을 집중하는 것이 효율적입니다.
> 

## DB 접근 보호 방식 비교

---

| 방식 | 설명 |
| --- | --- |
| IAM 권한의 SSM + 포트포워딩 | 1. 네트워크 계층: '문'이 없는 DB 보안. 데이터베이스가 해킹당하는 가장 흔한 경로는 열려 있는 포트를 통한 무차별 대입 공격(Brute-force)입니다. SSM은 이 물리적인 경로 자체를 제거합니다.
**인바운드 포트 완전 폐쇄**: DB 보안 그룹(SG)에서 외부망(0.0.0.0/0)을 향해 3306(MySQL)이나 5432(PostgreSQL) 포트를 열 필요가 전혀 없습니다.
**프라이빗 서브넷 격리**: DB는 공인 IP가 없는 프라이빗 서브넷에 깊숙이 격리됩니다. 외부에서는 DB의 존재조차 파악할 수 없으며, 오직 AWS 내부 백본망을 통한 암호화된 터널로만 데이터가 흐릅니다.
**공격 표면 제거**: 인터넷에 노출된 '문'이 없으므로 포트 스캐닝이나 네트워크 수준의 직접적인 침투 시도가 원천적으로 불가능해집니다.
2. 인증 계층: 키 관리에서 '권한 관리'로의 전환전통적인 방식의 가장 큰 약점은 유출될 수 있는 'SSH 키 파일(.pem)'에 의존한다는 점입니다. SSM은 이를 IAM 정책으로 대체합니다.
**ID 기반의 중앙 통제**: `.pem` 키 파일을 팀원끼리 공유하거나 이메일로 주고받을 필요가 없습니다. 대신 각 팀원의 AWS IAM 계정에 "DB 접근 터널을 뚫을 수 있는 권한"이 있는지 실시간으로 검증합니다.
**세밀한 접근 제어**: IAM 정책을 통해 특정 팀원은 '개발 DB'만, 특정 팀원은 '운영 DB'만 접근할 수 있도록 아주 정교하게 권한을 나눌 수 있습니다.
**즉각적인 권한 회수**: 팀원이 퇴사하거나 역할이 변경될 경우, 키를 교체할 필요 없이 IAM 정책 하나만 수정하면 즉시 DB 접근을 차단할 수 있습니다.
3. 감사 계층: 보안 사고 발생 시 가장 중요한 것은 "누가 어떤 데이터를 건드렸는가"를 파악하는 것입니다.
**모든 세션 기록**: 사용자가 DB 터널링을 시작한 시점부터 종료한 시점까지의 모든 세션 정보가 **AWS CloudWatch Logs** 또는 **S3**에 자동으로 기록됩니다.
**책임 소재 명확화**: 공용 SSH 키를 사용할 때는 '누가' 접속했는지 알기 어렵지만, SSM 방식은 접속자의 IAM 사용자 정보가 로그에 남기 때문에 관리적 투명성이 극대화됩니다. |
| IP 화이트리스트 + Bastion Host + SSH 터널링 | **1. 네트워크 계층의 격리**
이 방식은 DB를 인터넷이 닿지 않는 사설망에 배치하고, Bastion을 통해서만 접근을 허용하는 구조입니다.
DB의 물리적 은닉: DB는 공인 IP가 없는 Private Subnet에 배치되어 인터넷에서 직접적인 검색이나 접속 시도가 아예 불가능합니다.
보안 그룹(SG)을 통한 2중 잠금: DB의 보안 그룹은 오직 Bastion Host의 사설 IP로부터 오는 접속(예: 3306 포트)만 허용하도록 설정됩니다. 즉, Bastion을 해킹하지 않고는 DB에 접근할 경로가 네트워크 차원에서 차단됩니다.
IP 화이트리스트의 필터링: Bastion 서버 자체의 22번 포트도 아무나 접근할 수 없도록, 신뢰할 수 있는 특정 IP로만 인바운드 규칙을 제한하여 1차 방어벽을 형성합니다.
**2. 인증 계층**: 정적 키(Static Key)에 의존하는 보안인증 측면에서는 신원(Identity)보다는 '키(Key) 소유 여부'가 보안의 핵심이 됩니다.
SSH 키 기반 인증: 사용자는 아이디/비밀번호 대신 `.pem` 또는 `.pub` 키 파일을 통해 Bastion에 접속합니다. 이 키가 곧 DB로 향하는 유일한 '마스터 키' 역할을 합니다.
키 관리의 취약점: 키 파일은 한 번 생성되면 서버를 교체하기 전까지 유지되는 정적인 비밀번호와 같습니다. 만약 팀원 중 한 명의 PC가 감염되거나 키 파일이 유출되면, 해당 키를 가진 누구나 DB에 접근할 수 있는 치명적인 리스크가 있습니다.
인증 체계의 파편화: AWS IAM과는 별개로 리눅스 계정과 SSH 키를 별도로 관리해야 하므로, 팀원 변동 시 키를 회수하거나 교체하는 운영상의 번거로움이 발생합니다.
**3. 감사 계층**: 터널 내부 가시성의 한계보안 감사(Audit) 측면에서는 DB 내부에서 일어나는 행위를 추적하는 데 한계가 있습니다.
**접속 기록의 불투명성**: Bastion 서버의 로그에는 "누가 서버에 로그인했다"는 기록은 남지만, "그 안에서 어떤 DB 쿼리를 날렸는지"에 대한 상세한 기록은 기본적으로 남지 않습니다.
**터널 내부 암호화**: SSH 터널링을 통해 흐르는 데이터는 암호화되어 있어 네트워크 중간에서 가로챌 수는 없지만, 관리자가 사용자별 DB 작업 내역을 실시간으로 감시하거나 제어하기는 어렵습니다. |
| VPN | 1. 네트워크 계층: 네트워크 수준(L3 Layer)에서 DB로의 모든 직접적인 길을 차단하고 암호화된 터널만 남깁니다.
**DB 포트의 완전 은닉**: 인터넷 상의 누구도 DB의 공인 IP나 포트(3306, 5432 등)를 볼 수 없게 합니다.
**사설망 격리**: DB는 인터넷과 단절된 **Private Subnet**에 배치되며, 오직 VPN 터널을 성공적으로 생성한 기기만 해당 망에 진입할 수 있습니다.
**암호화된 데이터 전송**: 로컬 PC에서 DB 서버 사이의 모든 데이터 흐름이 암호화되어, 중간에서 패킷을 가로채더라도 내용을 알 수 없습니다.
2. 인증 및 관리 계층: '입구' 통제의 중앙화DB에 접속하기 전, 반드시 VPN 게이트웨이를 거쳐 신원을 확인해야 합니다.
**클라이언트 기반 인증**: 모든 팀원은 전용 VPN 앱을 설치해야 하며, 인증서나 다요소 인증(MFA)을 통해 터널을 생성해야 합니다.
**접근 권한 회수**: 팀원이 퇴사하거나 역할이 바뀔 때, VPN 접속 권한만 차단하면 해당 팀원의 모든 DB 접근 경로를 한 번에 막을 수 있습니다.
**고정된 진입점**: 보안 그룹(SG)에서 "VPN 게이트웨이의 사설 IP"로부터 오는 요청만 허용하도록 설정하여 DB 보안을 단순화할 수 있습니다.
3. DB 보안 관점에서의 결정적 고려사항
**측면 이동:** 한 번 VPN 망 안으로 들어오면, DB뿐만 아니라 해당 망 내의 다른 서버들(Redis, Kafka 등)에도 접근할 수 있는 권한이 생길 우려가 있습니다.**감사의 한계:** VPN은 "누가 네트워크에 접속했다"는 기록은 남기지만, "그 사람이 DB에서 어떤 데이터를 조회하거나 수정했는지"와 같은 세밀한 SQL 쿼리 로그는 기록하지 못합니다.
**과도한 권한 부여:** "DB 포트만 열어주는 것"이 아니라 "네트워크 망 전체를 열어주는 것"이기 때문에, 최소 권한 원칙을 지키기 어렵습니다.
**성능 병목:** 빅뱅 배포 당일 대량의 데이터 이관이나 검증 쿼리가 몰릴 때, VPN 게이트웨이의 **처리량** 한계로 인해 접속이 끊기거나 느려지는 리스크가 있습니다. |
| Zero Trust | 1. 신원 중심의 정교한 접근 제어 (L7 Layer): 전통적인 방식이 "어떤 IP"가 들어오는지를 본다면, Zero Trust는 **"누가"** 들어오는지를 애플리케이션 계층(L7)에서 확인합니다.
**애플리케이션 수준의 연결**: 네트워크망 전체(L3)를 열어주는 VPN과 달리, 사용자를 특정 DB 서비스(L7)에만 직접 연결합니다.
**SSO 연동**: Google, Okta 등 기존의 사내 계정과 연동하여 DB 접근 권한을 관리합니다. 별도의 DB 비밀번호나 SSH 키를 공유할 필요가 없어 관리 효율성이 높습니다.
**컨텍스트 기반 인증**: 단순히 아이디/비밀번호뿐만 아니라 접속 시간, 기기 보안 상태 등을 종합적으로 판단하여 DB 접근을 승인합니다.
2. 최소 권한 원칙의 실현: DB 보안에서 가장 위험한 '과도한 권한 부여' 문제를 기술적으로 해결합니다.
**세밀한 권한 분리**: 특정 개발자에게 “투표 리스트 DB의 조회(SELECT) 권한만 1시간 동안 부여"하는 식의 매우 정교한 제어가 가능합니다.
**측면 이동 차단**: 사용자가 특정 DB에 접속했다고 해서 동일한 네트워크망에 있는 다른 DB나 서버(Redis, Kafka 등)로 넘어가는 행위를 원천적으로 방지합니다.
**동적 권한 할당**: 평소에는 권한이 없다가, 장애 대응이나 배포 등 필요할 때만 임시로 승인받아 DB에 접속하게 할 수 있습니다.
3. 완벽한 가시성과 감사: DB 보안 사고 시 가장 중요한 "누가 어떤 데이터를 건드렸는가"에 대한 답을 제공합니다.
**모든 SQL 쿼리 기록**: 사용자가 DB에 접속해 실행한 모든 SQL 명령어를 실시간으로 기록하고 감시합니다.
**세션 녹화**: 터널을 통해 이루어지는 모든 작업 세션을 동영상처럼 녹화하여 사후 분석이나 보안 감사 대응 시 증거 자료로 활용할 수 있습니다.
**실시간 이상 행위 탐지**: 평소와 다른 대량의 데이터 조회나 민감 정보 접근 시 관리자에게 즉시 알림을 보내거나 세션을 강제 종료합니다. |

## VPN을 도입한 이유

- **GUI 접근성과 보안의 양립:** 기존에는 DB가 `localhost`로 묶여 있어 불편하게 SSH 커맨드라인에서만 쿼리를 실행해야 했습니다. 하지만 pgAdmin 같은 GUI 도구를 쓰기 위해 DB 포트를 외부에 여는 것은 보안상 매우 위험합니다. VPN은 **DB 포트를 외부에 노출하지 않고도**, 팀원만 들어올 수 있는 가상 내부 네트워크를 만들어 이 문제를 해결합니다.
- **신원 기반의 강력한 통제:** 전 세계 누구에게나 열린 공인 IP 접속과 달리, VPN은 각 팀원에게 **고유한 인증 키**를 발급합니다. 이 키가 있는 6명의 팀원만 서버 내부망에 진입할 수 있으므로, 외부인의 접근 시도를 원천 차단하는 강력한 방어선을 구축할 수 있습니다.
- **단일 진입점을 통한 관리 효율:** DB뿐만 아니라 서버 내의 다른 자원(Redis, 로그 파일 등)도 별도의 복잡한 설정 없이 VPN 터널 하나로 로컬 환경처럼 안전하게 관리할 수 있게 되었습니다.

## VPN 종류

---

## **VPN**

VPN(Virtual Private Network)은 공용 네트워크(인터넷)를 마치 전용선으로 연결된 사설 네트워크처럼 사용할 수 있게 해주는 기술

```
핵심원리

터널링: 데이터를 외부에서 볼 수 없는 '가상 터널'에 담아 전송하는 기술입니다. 원래의 데이터 패킷을 다른 패킷 안에 캡슐화하여 보호합니다.
암호화: 터널을 지나가는 데이터를 암호화하여, 설령 데이터가 중간에 탈취되더라도 내용을 읽을 수 없게 만듭니다.
인증: 허가된 사용자나 장치만 이 터널에 진입할 수 있도록 신원을 확인합니다.

```

## 1. IPsec VPN

**개념**: 네트워크 계층(L3)에서 암호화하는 전통적인 VPN 프로토콜

**특징**:

- Site-to-Site 연결에 주로 사용 (온프레미스 ↔ AWS VPC)
- IKE(Internet Key Exchange)로 키 교환
- ESP(Encapsulating Security Payload)로 데이터 암호화

**AWS 적용**: AWS Site-to-Site VPN, Transit Gateway VPN

**적합한 상황**: 회사 사무실 네트워크 전체를 AWS VPC와 연결할 때

---

## 2. SSL/TLS VPN (OpenVPN)

**개념**: 애플리케이션 계층에서 SSL/TLS로 암호화하는 VPN

**특징**:

- 클라이언트-서버 방식 (개별 사용자 접속)
- TCP 443 포트 사용 가능 (방화벽 우회 용이)
- 인증서 + 사용자 인증 조합

**AWS 적용**: AWS Client VPN (OpenVPN 기반)

**적합한 상황**: 원격 개발자가 개별적으로 VPC 내부 리소스에 접근할 때

---

## 3. WireGuard

**개념**: 최신 경량 VPN 프로토콜, 커널 레벨에서 동작

**특징**:

- 코드베이스가 작음 (약 4,000줄) → 보안 감사 용이
- UDP 기반, 매우 빠른 성능
- 공개키 암호화 방식
- 연결/재연결이 빠름

**적용 도구**: Tailscale, Netmaker, 직접 구축

**적합한 상황**: 빠른 설정, 고성능이 필요한 소규모 팀 환경

---

| 기술 | 주요 사용처 | 주요 특징 |
| --- | --- | --- |
| IPsec | Site-to-Site, 기업 환경 | 하드웨어 가속(AES-NI 등)을 지원하여 대역폭이 안정적이고, AWS Site-to-Site VPN처럼 클라우드 사업자가 직접 관리해주는 서비스가 많아 신뢰도가 높음 |
| SSL/TLS (OpenVPN) | 원격 접속, Client VPN | 최신 암호화 알고리즘(ChaCha20)을 사용하여 IPsec이나 OpenVPN보다 오버헤드가 훨씬 적고 전송 속도가 빠름 |
| WireGuard | 개인/소규모 팀, 모던 환경 | 개별 사용자의 접속 제어와 인증(MFA 등)이 간편하며, 포트 443(HTTPS)을 이용해 어디서나 방화벽 제약 없이 접속 |

## VPN 중 WIreGuard를 적용한 이유(직접 구축)

단일 EC2 자원을 공유하는 여러 서비스에 부하를 주지 않도록 **커널 레벨에서 동작하는 초경량 설계**를 채택하여 전체 시스템 성능을 온전히 보존했습니다.
기존 대비 압도적으로 낮은 지연 시간 덕분에 pgAdmin 작업 시 대량의 데이터 조회도 **로컬 환경과 다름없는 쾌적한 속도**로 처리할 수 있습니다.
약 4,000줄의 간결한 코드로 구성되어 보안 취약점이 적고, 소규모 팀이 별도의 운영 공수 없이 **최신 암호화 기술**을 직접 관리하기에 매우 용이합니다.