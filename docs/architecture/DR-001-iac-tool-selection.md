# DR-001: 인프라 관리 도구(IaC) 선정 의사결정

| 항목 | 내용 |
|------|------|
| 날짜 | 2026-01-23 |
| 상태 | 승인됨 |
| 적용 단계 | v1 (Big Bang) |
| 주요 목표 | IaC 도구 선정을 위한 4개 후보(CloudFormation, Ansible, Terraform, OpenTofu) 비교 분석 및 Terraform 채택 결정 |

---

## 1) IaC 도입 배경

현재 인프라는 주로 AWS 콘솔에서 수동으로 생성/수정되어 왔고, 그 결과 아래 문제가 발생했다.

- 인프라 현황 불투명: 규모는 크지 않지만 "지금 무엇이, 어떤 설정으로 떠 있는지"를 팀이 공통 기준으로 확신하기 어렵다.
- 변경 추적 불가: 누가/언제/무엇을 바꿨는지 기록이 남지 않아 이슈 발생 시 원인 추적이 어렵다.
- 휴먼 에러/드리프트 누적: 테스트/실험으로 생성·삭제가 반복되며 설정이 미묘하게 달라지거나 누락되는 일이 생긴다.
- 하이브리드 확장 예정: 향후 AI 워크로드를 위해 RunPod 같은 GPU 클라우드 도입이 예정되어 있어 운영 복잡도가 커질 가능성이 있다.

따라서 인프라를 "수동 운영"이 아니라 코드로 고정하고, 적용 전 변경 영향(Plan)을 검증하며, 현재 상태를 하나의 기준(State)으로 관리하는 IaC 체계가 필요하다.

---

## 2) 요구사항 (Criteria)

- R1. 상태/가시성: "지금 무엇이 떠 있는지"를 코드/상태로 명확히 확인 가능해야 한다.
- R2. 변경 예측: 적용 전 변경 영향(생성/수정/삭제)을 plan으로 확인 가능해야 한다.
- R3. 드리프트 관리: 코드와 실환경 차이를 감지/정리할 수 있어야 한다.
- R4. 벤더 중립/확장성: AWS뿐 아니라 RunPod까지 단일 워크플로우로 확장 가능해야 한다.
- R5. 빠른 도입: 지금 문제를 빠르게 해결할 수 있을 만큼 도입이 단순해야 한다.

---

## 3) 조사한 IaC 도구 후보 (Candidate Options)

- AWS CloudFormation
- Ansible
- Terraform
- OpenTofu

---

## 4) 후보별 조사 요약 (Options Deep Dive)

### 4.1 AWS CloudFormation

개요

- AWS 네이티브 IaC로, 템플릿(YAML/JSON) 기반으로 리소스를 선언하고 "Stack" 단위로 배포/업데이트/롤백을 관리한다.
- 상태는 AWS가 내부적으로 관리하며(스택 상태), 리소스 변경 내역은 이벤트로 추적된다.

강점

- AWS 리소스 정합성/안정성: AWS 업데이트 정책과 롤백 체계가 잘 갖춰져 있다.
- 운영 편의: 별도의 state 파일을 직접 보관/잠금 관리하지 않아도 스택 단위 운영이 가능하다.
- 드리프트 감지 기능 제공(단, AWS 범위 내): 스택과 실제 리소스 사이의 차이를 확인할 수 있다.

제약/리스크 (우리 요구사항 관점)

- R4(벤더 중립/확장성)에서 결정적 한계: RunPod 같은 외부 벤더를 동일한 선언/상태 모델로 통합 관리하기 어렵다.
- Custom Resource(예: Lambda로 외부 API 호출)로 우회 가능하나,
  - 선언적 단순성이 약해지고,
  - 재시도/오류 처리/멱등성/상태 추적을 우리 코드로 유지보수해야 하며,
  - 결과적으로 도구 이원화 또는 커스텀 로직 관리 부담이 커질 수 있다.

---

### 4.2 Ansible

개요

- 에이전트리스(주로 SSH) 방식의 자동화/구성 관리 도구로, 플레이북(작업 목록)을 순서대로 실행한다.
- 서버 내부 설정(패키지 설치, 파일/권한, 서비스 설정 등)을 멱등적으로 맞추는 데 강점이 있다.

강점

- 구성 관리/배포 자동화에 강함: 서버 내부 설정을 표준화하고 반복 실행에 안정적이다.
- 실행 결과가 태스크 단위로 남아 문제 파악이 상대적으로 쉽다.

제약/리스크 (우리 요구사항 관점)

- R1~R3(상태/가시성/드리프트)에 맞는 "인프라 전체 상태 모델링"이 약하다.
- 인프라 리소스를 만들 수는 있으나, Terraform처럼 리소스 ID를 매핑한 단일 state로 "전체 형상"을 지속 추적하는 관점이 약하다.
- 삭제/정리 흐름이 구조적으로 약해질 수 있다(삭제 작업을 별도로 설계/관리해야 하며 누락 시 좀비 리소스 발생 가능).
- 인프라 관점의 "plan 수준 변경 예측"이 제한적이다.

---

### 4.3 Terraform

개요

- 선언적 IaC. Provider 플러그인으로 다양한 벤더(AWS 포함)를 같은 방식으로 제어한다.
- `plan`(변경 예측) + `state`(현재 형상 추적)가 핵심 운영 메커니즘이다.

강점

- R1~R3에 매우 적합: state로 "무엇이 떠 있는지"를 명확히 하고, plan으로 변경 영향을 예측하며, 드리프트 감지/정리 흐름을 만들기 쉽다.
- R4에 적합: provider 기반으로 AWS 외 벤더(예: RunPod)까지 같은 워크플로우로 확장 가능하다.
- R5에 유리: 점유율과 생태계 기반으로 문서/사례/트러블슈팅 풀이가 풍부해 빠른 도입에 유리하다.

리스크

- state는 핵심 자산이므로 원격 backend/lock/권한 관리가 필수(협업 기준 수립 필요).
- 외부 벤더 provider 성숙도에 따라 관리 품질이 달라질 수 있다.

---

### 4.4 OpenTofu

개요

- Terraform 1.5 계열 기반 포크로, HCL 문법/Provider 모델/워크플로우 호환을 지향한다.
- 기본 사용 흐름은 Terraform과 매우 유사하다.

강점

- Terraform과 동일 계열로 R1~R4를 동일하게 충족 가능한 구조(state/plan/provider 기반).
- 오픈 거버넌스 기반 대안으로 인식되며, 운영/보안 기능 측면에서의 방향성이 장점으로 언급된다.

리스크

- 도입 초기 기준으로는 Terraform 대비 참고할 수 있는 사례/튜토리얼/질의응답 풀이가 상대적으로 적을 수 있다.
- 독자 기능 추가로 장기적으로는 "완전 동일"이 아니라 "호환을 유지하는 선에서의 분화"가 진행될 수 있다.

---

## 5) 후보군 압축 (Shortlist)

위 후보군을 요구사항(R1~R5)에 비추어 검토한 결과, 최종 비교 대상은 다음처럼 압축된다.

- CloudFormation: AWS 단독 기준으로는 강력하나, RunPod까지 동일한 모델로 통합 관리하기 어려워 R4에서 불리
- Ansible: 구성 관리에 강하지만, 현재 목표인 "상태 기반 인프라 프로비저닝/수명주기 관리(가시성/plan/드리프트)"에는 R1~R3 관점에서 적합도가 낮음

→ 요구사항(R1~R4)을 가장 직접적으로 만족하는 후보는 Terraform 계열(선언적 + state + provider)이며,
실질 비교 대상은 Terraform vs OpenTofu로 좁혀진다.

---

## 6) 핵심 비교: Terraform vs OpenTofu (심층 분석)

### 6.1 계보/호환성: 현재는 "거의 동일", 장기엔 "점진적 분화" 가능

- OpenTofu는 Terraform 1.5.x 기반으로 시작했고, 현재는 HCL/Provider/State 워크플로우가 매우 유사하다.
- 실무적으로는 대부분의 모듈/Provider가 동일한 방식으로 동작하는 것을 목표로 한다.
- 다만 OpenTofu는 독자 기능을 지속 추가하고 있어, 시간이 갈수록 기능/옵션/동작에서 차이가 생길 수 있다(호환 유지 중심의 분화).

### 6.2 라이선스/거버넌스: "즉시 제약" vs "장기 선택권"

- OpenTofu가 등장한 배경은 Terraform의 BSL 전환이다.
- 다만 현 시점에서 BSL은 "내부 인프라 관리 목적 사용"에 즉각적인 제약을 주는 성격은 아니다.
- 따라서 단기적으로는 라이선스보다 도입 속도/학습 비용이 더 큰 의사결정 변수가 된다.
- 장기적으로 "벤더 정책 변화 리스크"를 낮추고 싶다면 OpenTofu의 오픈 거버넌스가 선택지로 남는다.

### 6.3 기능 차이(체감 포인트): OpenTofu의 State/Plan 암호화

- OpenTofu는 state/plan을 암호화하여 저장/보관하는 기능을 제공한다(운영/보안 측면에서 구분점).
- Terraform은 기본 OSS 워크플로우에서 동일한 형태의 내장 암호화가 핵심 차별점으로 잡히지 않는 편이다.
- 다만 우리 팀은 우선 "가시성 확보/변경 추적 표준화"가 1순위이므로, 이 기능은 즉시 채택 사유라기보다 추후 강화 포인트로 보는 것이 자연스럽다.

### 6.4 생태계/레퍼런스: Terraform이 도입 속도에 유리

- Terraform은 점유율과 역사로 인해 예제/문서/트러블슈팅 풀이가 가장 풍부하다.
- 초기 도입 단계에서 "막히는 구간을 빠르게 해결"해야 하는 팀에게는 이 차이가 바로 리드타임 차이로 연결된다.

### 6.5 운영/비용 변수: Terraform CLI vs Terraform Cloud는 분리해서 본다

- Terraform "도구 채택"과 Terraform "SaaS(Cloud) 채택"은 별개의 결정이다.
- 우리는 S3 + DynamoDB Lock 기반 원격 state를 합의 사항으로 두어, SaaS 정책 변화 영향을 최소화한다.

---

## 7) 최종 결정 (Decision)

초기 도입 단계에서의 빠른 적용과 학습 비용 최소화(R5)를 최우선으로 하여, IaC 도구로 Terraform을 채택한다.

결정 이유

1. 문제 해결 적합성(R1~R3): state/plan 기반으로 현재 인프라 가시화와 변경 예측이 가능
2. 미래 확장성(R4): provider 기반으로 AWS뿐 아니라 RunPod까지 동일 워크플로우로 확장 가능
3. 빠른 도입(R5): 레퍼런스/사례/트러블슈팅 풀이가 풍부해 초기 시행착오 최소화
